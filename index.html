<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mentor Matching Tool</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --color-primary: #10b981;
        --color-primary-dark: #059669;
        --color-secondary: #34d399;
        --color-accent: #6ee7b7;
        --color-light: #ecfdf5;
        --color-dark: #064e3b;
      }

      .sticky-note {
        @apply bg-green-50 shadow-md rounded-md p-3 mb-2 transition-all duration-300;
      }

      .sticky-note:hover {
        @apply shadow-lg transform -translate-y-1;
      }

      .sticky-note-work {
        @apply bg-emerald-100;
      }

      .sticky-note-relationships {
        @apply bg-green-100;
      }

      .sticky-note-health {
        @apply bg-teal-100;
      }

      .sticky-note-play {
        @apply bg-lime-100;
      }

      .dragging {
        @apply opacity-50 shadow-xl;
      }
    </style>
    <style>
      :root {
        --primary-color: #10b981;
        --primary-dark: #059669;
        --secondary-color: #34d399;
        --accent-color: #6ee7b7;
        --light-color: #ecfdf5;
        --dark-color: #064e3b;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-color);
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
      }

      .hero-section {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        padding: 4rem 2rem;
        border-radius: 1rem;
        margin-bottom: 3rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .hero-content {
        max-width: 800px;
        margin: 0 auto;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
      }

      .feature-card {
        background: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .feature-icon {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
      }

      .btn-secondary {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
      }

      .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .form-check-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(16, 185, 129, 0.25);
      }

      .section-header {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .card-title {
        color: var(--primary-color);
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
      }

      .form-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border-radius: 10px;
        background-color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .progress-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
      }

      .progress-step {
        flex: 1;
        text-align: center;
        position: relative;
      }

      .progress-step::after {
        content: "";
        height: 2px;
        background-color: #e5e7eb;
        position: absolute;
        top: 15px;
        left: 50%;
        right: -50%;
        z-index: 0;
      }

      .progress-step:last-child::after {
        display: none;
      }

      .progress-step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e5e7eb;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
        margin-bottom: 0.5rem;
        transition: background-color 0.3s ease;
      }

      .progress-step.active .progress-step-number {
        background-color: var(--primary-color);
        color: white;
      }

      .progress-step.completed .progress-step-number {
        background-color: var(--secondary-color);
        color: white;
      }

      .tag-input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 0.25rem;
        min-height: 100px;
      }

      .tag {
        background-color: #4f46e5;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        display: inline-flex;
        align-items: center;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .tag-remove {
        margin-left: 0.5rem;
        cursor: pointer;
      }

      .brainstorm-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }

      .brainstorm-column {
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        min-height: 300px;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }

      .loading-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #4f46e5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #10b981;
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transform: translateX(200%);
        transition: transform 0.3s ease-out;
      }

      .success-message.show {
        transform: translateX(0);
      }

      .btn-primary {
        background-color: #4f46e5;
        border-color: #4f46e5;
      }

      .btn-primary:hover {
        background-color: #4338ca;
        border-color: #4338ca;
      }

      .btn-secondary {
        background-color: #f97316;
        border-color: #f97316;
      }

      .btn-secondary:hover {
        background-color: #ea580c;
        border-color: #ea580c;
      }

      .next-steps-card {
        background-color: #f8fafc;
        border-left: 4px solid #4f46e5;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 0.25rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .skill-level {
        display: flex;
        align-items: center;
        margin-top: 0.5rem;
      }

      .skill-level-circle {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #e5e7eb;
        margin-right: 0.25rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .skill-level-circle.filled {
        background-color: #4f46e5;
      }

      /* Timer styles */
      .timer-container {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .timer-display {
        font-size: 2rem;
        font-weight: bold;
        font-family: monospace;
        color: white;
      }

      .note-counter,
      .high-score {
        font-size: 1.2rem;
        color: white;
      }

      .timer-container.active {
        animation: pulse 2s infinite;
      }

      .timer-container.ending {
        animation: pulse-warning 1s infinite;
      }

      @keyframes pulse {
        0% {
          background-color: rgba(255, 255, 255, 0.1);
        }
        50% {
          background-color: rgba(255, 255, 255, 0.2);
        }
        100% {
          background-color: rgba(255, 255, 255, 0.1);
        }
      }

      @keyframes pulse-warning {
        0% {
          background-color: rgba(255, 87, 34, 0.1);
        }
        50% {
          background-color: rgba(255, 87, 34, 0.2);
        }
        100% {
          background-color: rgba(255, 87, 34, 0.1);
        }
      }

      /* Mobile optimizations */
      @media (max-width: 768px) {
        .brainstorm-container {
          grid-template-columns: 1fr;
        }

        .progress-step-text {
          font-size: 0.75rem;
        }
      }

      .solution-card {
        transition: transform 0.2s ease-in-out;
      }

      .solution-card:hover {
        transform: translateY(-5px);
      }

      .solution-card .card-title {
        color: #4f46e5;
      }

      .prd-section h6 {
        font-weight: 600;
      }

      .prd-section ul li {
        margin-bottom: 0.5rem;
      }

      #prd-content {
        font-size: 0.95rem;
      }

      .prd-content.editing .prd-section {
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .prd-content.editing .prd-section:focus-within {
        border-color: #4f46e5;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
      }

      .prd-content.editing [contenteditable] {
        outline: none;
        padding: 0.25rem;
        border-radius: 0.25rem;
      }

      .prd-content.editing [contenteditable]:hover {
        background-color: rgba(79, 70, 229, 0.05);
      }

      .prd-content.editing [contenteditable]:focus {
        background-color: rgba(79, 70, 229, 0.1);
      }

      .progress {
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
      }
      .progress-bar {
        background-color: #4f46e5;
        border-radius: 10px;
      }
      .metric-item label {
        margin-bottom: 5px;
        font-weight: 500;
      }
      .growth-area-card {
        border-left: 4px solid #4f46e5;
        margin-bottom: 1rem;
      }
      .recommendation-card {
        border-left: 4px solid #f97316;
        margin-bottom: 1rem;
      }
      .priority-high {
        color: #dc2626;
      }
      .priority-medium {
        color: #f97316;
      }
      .priority-low {
        color: #10b981;
      }
      .project-card {
        transition: transform 0.2s ease-in-out;
        position: relative;
      }
      .project-card:hover {
        transform: translateY(-5px);
      }
      .project-card.saved {
        border-color: #4f46e5;
      }
      .pin-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1;
      }
      .pin-btn.pinned {
        color: #4f46e5;
      }
      .mentor-section {
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        margin-top: 1rem;
        padding-top: 1rem;
      }
      .mentor-image {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
      }
      .mentor-bio {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
      }
      .mentor-header {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .mentor-name {
        font-weight: 600;
        color: #4f46e5;
        margin: 0;
      }

      /* Add styles to ensure the widget doesn't interfere with the main content */
      elevenlabs-convai {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }

      .language-options {
        max-height: 200px;
        overflow-y: auto;
      }
      .form-check {
        margin-bottom: 0.5rem;
      }
      .card {
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .card-title {
        color: #4f46e5;
        font-weight: 600;
      }
      .form-label {
        font-weight: 500;
      }
      .text-danger {
        font-weight: bold;
      }
      .form-check-label strong {
        display: block;
        margin-bottom: 0.25rem;
      }
      .form-check {
        margin-bottom: 0.75rem;
      }
      .card-title i {
        color: #4f46e5;
      }
      .academic-interests,
      .extracurricular-interests {
        padding: 0.5rem;
      }
      .form-check-input:checked {
        background-color: #4f46e5;
        border-color: #4f46e5;
      }
      .form-check-input:focus {
        border-color: #4f46e5;
        box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
      }
      textarea:focus {
        border-color: #4f46e5;
        box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
      }
      .text-muted.small {
        font-size: 0.875rem;
      }
      .card {
        border-radius: 0.5rem;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .card-body {
        padding: 1.5rem;
      }
      .invalid-feedback {
        font-size: 0.875rem;
      }
      .text-primary {
        color: var(--primary-color) !important;
      }
      .bg-primary {
        background-color: var(--primary-color) !important;
      }
      .border-primary {
        border-color: var(--primary-color) !important;
      }
      .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
      }
      .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      .mentor-name {
        color: var(--primary-color);
      }
      .pin-btn.pinned {
        color: var(--primary-color);
      }
      a {
        color: var(--primary-color);
      }
      a:hover {
        color: var(--primary-dark);
      }
      .progress-bar {
        background-color: var(--primary-color);
      }
      .growth-area-card {
        border-left: 4px solid var(--primary-color);
      }
      .recommendation-card {
        border-left: 4px solid var(--secondary-color);
      }
    </style>
    <style>
      /* Override any Bootstrap default colors */
      .btn-link {
        color: var(--primary-color);
      }
      .btn-link:hover {
        color: var(--primary-dark);
      }
      .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(16, 185, 129, 0.25);
      }
      .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(16, 185, 129, 0.25);
      }
      .nav-link {
        color: var(--primary-color);
      }
      .nav-link:hover {
        color: var(--primary-dark);
      }
      .nav-pills .nav-link.active {
        background-color: var(--primary-color);
      }
      .page-link {
        color: var(--primary-color);
      }
      .page-link:hover {
        color: var(--primary-dark);
      }
      .page-item.active .page-link {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      .dropdown-item.active,
      .dropdown-item:active {
        background-color: var(--primary-color);
      }
      .custom-control-input:checked ~ .custom-control-label::before {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      /* Update any remaining specific color values */
      [class*="text-primary"] {
        color: var(--primary-color) !important;
      }
      [class*="bg-primary"] {
        background-color: var(--primary-color) !important;
      }
      [class*="border-primary"] {
        border-color: var(--primary-color) !important;
      }

      /* Ensure proper contrast for text on primary background */
      .bg-primary,
      .btn-primary,
      .nav-pills .nav-link.active {
        color: white !important;
      }

      /* Update focus states */
      *:focus {
        outline-color: var(--primary-color);
      }

      /* Update selection color */
      ::selection {
        background-color: rgba(16, 185, 129, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <header class="hero-section text-center">
        <div class="hero-content">
          <h1 class="display-3 fw-bold mb-4">ðŸŒŸ Impact Mentor Hub</h1>
          <p class="lead mb-4">
            Connecting underprivileged middle and high school students with
            dedicated mentors through AI-powered matching.
          </p>
        </div>
      </header>

      <!-- Add this section after the header -->
      <div class="mission-section mb-5 text-center">
        <h2 class="mb-4">Our Mission</h2>
        <p class="lead">
          Inspired by the transformative power of mentorship that has helped
          students achieve their dreams, including gaining admission to
          Stanford, we're dedicated to bringing these life-changing
          opportunities to underprivileged youth nationwide.
        </p>
      </div>

      <!-- Add Technology Stack Section -->
      <div class="tech-stack-section mb-5">
        <h2 class="text-center mb-4">Powered by Advanced Technology</h2>
        <div class="row g-4">
          <div class="col-md-4">
            <div class="tech-card h-100">
              <div class="card-body text-center">
                <i
                  class="fas fa-brain display-4 mb-3"
                  style="color: var(--primary-color)"
                ></i>
                <h4>AI</h4>
                <p>
                  Customized project recommendations aligned with your interests
                  and community needs.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="tech-card h-100">
              <div class="card-body text-center">
                <i
                  class="fas fa-database display-4 mb-3"
                  style="color: var(--primary-color)"
                ></i>
                <h4>MongoDB</h4>
                <p>
                  Secure and scalable management of mentor-mentee profiles and
                  progress tracking.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="tech-card h-100">
              <div class="card-body text-center">
                <i
                  class="fas fa-comments display-4 mb-3"
                  style="color: var(--primary-color)"
                ></i>
                <h4>Voice AI</h4>
                <p>
                  Immersive, AI-driven mentorship interactions for realistic
                  conversational experiences.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <style>
        .tech-card {
          background: white;
          border-radius: 1rem;
          border: 1px solid rgba(16, 185, 129, 0.1);
          transition: transform 0.3s ease;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .tech-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
        }
        .progress-indicator {
          background: white;
          padding: 1.5rem;
          border-radius: 1rem;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .form-section {
          background: white;
          border-radius: 1rem;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .card {
          border: 1px solid rgba(16, 185, 129, 0.1);
        }
        .section-header {
          border-radius: 1rem;
        }
        .btn-primary {
          padding: 0.75rem 1.5rem;
          font-weight: 500;
          transition: all 0.3s ease;
        }
        .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
      </style>

      <!-- Progress indicator styling update -->
      <style>
        .progress-step.active .progress-step-number {
          background-color: var(--primary-color);
        }
        .progress-step.completed .progress-step-number {
          background-color: var(--secondary-color);
        }
      </style>

      <!-- Add the conversational agent at the top level of the app container -->
      <elevenlabs-convai agent-id="6hPztPZzJjupiafXw7XA"></elevenlabs-convai>

      <div class="progress-indicator mb-4">
        <div class="progress-step active" id="step1">
          <div class="progress-step-number">1</div>
          <div class="progress-step-text">Personal Info</div>
        </div>
        <div class="progress-step" id="step2">
          <div class="progress-step-number">2</div>
          <div class="progress-step-text">Skills & Projects</div>
        </div>
        <div class="progress-step" id="step3">
          <div class="progress-step-number">3</div>
          <div class="progress-step-text">Edge Analysis</div>
        </div>
        <div class="progress-step" id="step4">
          <div class="progress-step-number">4</div>
          <div class="progress-step-text">Project Generation</div>
        </div>
      </div>

      <!-- Step 1: Personal Information -->
      <section id="personal-info-section" class="form-section">
        <div class="section-header">
          <h2><i class="fas fa-user me-2"></i>Personal Information</h2>
          <p>Tell us about yourself to help personalize your experience.</p>
        </div>

        <form id="personal-info-form" class="needs-validation" novalidate>
          <!-- Basic Information -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">Basic Information</h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="name" class="form-label"
                    >Full Name <span class="text-danger">*</span></label
                  >
                  <input type="text" class="form-control" id="name" required />
                  <div class="invalid-feedback">
                    Please enter your full name.
                  </div>
                </div>
                <div class="col-md-2">
                  <label for="age" class="form-label"
                    >Age <span class="text-danger">*</span></label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="age"
                    min="5"
                    max="18"
                    required
                  />
                  <div class="invalid-feedback">
                    Please enter a valid age (5-18).
                  </div>
                </div>
                <div class="col-md-4">
                  <label for="gender" class="form-label"
                    >Gender <span class="text-danger">*</span></label
                  >
                  <select class="form-select" id="gender" required>
                    <option value="">Select Gender</option>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="non-binary">Non-binary</option>
                    <option value="other">Other</option>
                    <option value="prefer-not">Prefer not to say</option>
                  </select>
                  <div class="invalid-feedback">Please select your gender.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- School Information -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">School Information</h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="schoolDistrict" class="form-label"
                    >School District <span class="text-danger">*</span></label
                  >
                  <select class="form-select" id="schoolDistrict" required>
                    <option value="">Select School District</option>
                    <option value="albany">
                      Albany Unified School District
                    </option>
                    <option value="benicia">
                      Benicia Unified School District
                    </option>
                    <option value="cabrillo">
                      Cabrillo Unified School District
                    </option>
                    <option value="dixon">Dixon Unified School District</option>
                    <option value="fairfield">
                      Fairfield-Suisun Unified School District
                    </option>
                    <option value="fremont">
                      Fremont Unified School District
                    </option>
                    <option value="geyserville">
                      Geyserville Unified School District
                    </option>
                    <option value="gilroy">
                      Gilroy Unified School District
                    </option>
                    <option value="hayward">
                      Hayward Unified School District
                    </option>
                    <option value="healdsburg">
                      Healdsburg Unified School District
                    </option>
                    <option value="lahonda">
                      La Honda-Pescadero Unified School District
                    </option>
                    <option value="martinez">
                      Martinez Unified School District
                    </option>
                    <option value="milpitas">
                      Milpitas Unified School District
                    </option>
                    <option value="morganhill">
                      Morgan Hill Unified School District
                    </option>
                    <option value="mtdiablo">
                      Mount Diablo Unified School District
                    </option>
                    <option value="napa">
                      Napa Valley Unified School District
                    </option>
                    <option value="novato">
                      Novato Unified School District
                    </option>
                    <option value="oakland">
                      Oakland Unified School District
                    </option>
                    <option value="paloalto">
                      Palo Alto Unified School District
                    </option>
                    <option value="pleasanton">
                      Pleasanton Unified School District
                    </option>
                    <option value="riverdelta">
                      River Delta Unified School District
                    </option>
                    <option value="sainthelena">
                      Saint Helena Unified School District
                    </option>
                    <option value="sanfrancisco">
                      San Francisco Unified School District
                    </option>
                    <option value="santaclara">
                      Santa Clara Unified School District
                    </option>
                    <option value="shoreline">
                      Shoreline Unified School District
                    </option>
                    <option value="sonoma">
                      Sonoma Valley Unified School District
                    </option>
                    <option value="southsf">
                      South San Francisco Unified School District
                    </option>
                    <option value="vallejo">
                      Vallejo City Unified School District
                    </option>
                    <option value="westcontra">
                      West Contra Costa Unified School District
                    </option>
                    <option value="windsor">
                      Windsor Unified School District
                    </option>
                    <option value="other">Other</option>
                  </select>
                  <div class="invalid-feedback">
                    Please select your school district.
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="schoolName" class="form-label"
                    >School Name <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="schoolName"
                    required
                    placeholder="Enter your school name"
                  />
                  <div class="invalid-feedback">
                    Please enter your school name.
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="gradeLevel" class="form-label"
                    >Grade Level <span class="text-danger">*</span></label
                  >
                  <select class="form-select" id="gradeLevel" required>
                    <option value="">Select Grade Level</option>
                    <optgroup label="Elementary School">
                      <option value="K">Kindergarten</option>
                      <option value="1">1st Grade</option>
                      <option value="2">2nd Grade</option>
                      <option value="3">3rd Grade</option>
                      <option value="4">4th Grade</option>
                      <option value="5">5th Grade</option>
                    </optgroup>
                    <optgroup label="Middle School">
                      <option value="6">6th Grade</option>
                      <option value="7">7th Grade</option>
                      <option value="8">8th Grade</option>
                    </optgroup>
                    <optgroup label="High School">
                      <option value="9">9th Grade (Freshman)</option>
                      <option value="10">10th Grade (Sophomore)</option>
                      <option value="11">11th Grade (Junior)</option>
                      <option value="12">12th Grade (Senior)</option>
                    </optgroup>
                  </select>
                  <div class="invalid-feedback">
                    Please select your grade level.
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="cityNeighborhood" class="form-label"
                    >City/Neighborhood <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="cityNeighborhood"
                    required
                  />
                  <div class="invalid-feedback">
                    Please enter your city or neighborhood.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Language and Contact -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">Language and Contact Information</h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label"
                    >Preferred Language
                    <span class="text-danger">*</span></label
                  >
                  <div class="language-options">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langEnglish"
                        value="english"
                        required
                      />
                      <label class="form-check-label" for="langEnglish"
                        >English</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langSpanish"
                        value="spanish"
                      />
                      <label class="form-check-label" for="langSpanish"
                        >Spanish</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langChinese"
                        value="chinese"
                      />
                      <label class="form-check-label" for="langChinese"
                        >Chinese (Mandarin/Cantonese)</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langVietnamese"
                        value="vietnamese"
                      />
                      <label class="form-check-label" for="langVietnamese"
                        >Vietnamese</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langTagalog"
                        value="tagalog"
                      />
                      <label class="form-check-label" for="langTagalog"
                        >Tagalog</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="preferredLanguage"
                        id="langOther"
                        value="other"
                      />
                      <label class="form-check-label" for="langOther"
                        >Other</label
                      >
                    </div>
                  </div>
                  <div
                    id="otherLanguageInput"
                    class="mt-2"
                    style="display: none"
                  >
                    <input
                      type="text"
                      class="form-control"
                      id="otherLanguageSpecify"
                      placeholder="Please specify your preferred language"
                    />
                  </div>
                  <div class="invalid-feedback">
                    Please select your preferred language.
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="guardianContact" class="form-label"
                    >Guardian/Parent Contact Information (Optional)</label
                  >
                  <textarea
                    class="form-control"
                    id="guardianContact"
                    rows="3"
                    placeholder="Enter phone number and/or email address"
                  ></textarea>
                  <small class="text-muted"
                    >This information will be kept private and used only for
                    program-related communications.</small
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Interests Section -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">Interests & Hobbies</h5>
              <p class="text-muted small">
                Type and press Enter to add multiple interests
              </p>
              <div class="tag-input-container" id="interests-container">
                <input
                  type="text"
                  class="form-control tag-input"
                  id="interests-input"
                  placeholder="Technology, reading, hiking, etc."
                />
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end">
            <button
              type="button"
              class="btn btn-primary px-4"
              id="next-to-skills"
            >
              Next: Skills & Projects <i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </form>
      </section>

      <!-- Step 2: Skills & Projects -->
      <section id="skills-section" class="form-section" style="display: none">
        <div class="section-header">
          <h2><i class="fas fa-code me-2"></i>Interest and Mentor Matching</h2>
          <p>
            Help us understand your interests and preferences for mentorship.
          </p>
        </div>

        <form id="interests-form" class="needs-validation" novalidate>
          <!-- Academic Interests -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="fas fa-book me-2"></i>Preferred Academic Subjects
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="academic-interests">
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="math"
                        name="academic_interests"
                        value="mathematics"
                      />
                      <label class="form-check-label" for="math"
                        >Mathematics</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="science"
                        name="academic_interests"
                        value="science"
                      />
                      <label class="form-check-label" for="science"
                        >Science & Technology</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="arts"
                        name="academic_interests"
                        value="arts"
                      />
                      <label class="form-check-label" for="arts"
                        >Arts & Humanities</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="social"
                        name="academic_interests"
                        value="social"
                      />
                      <label class="form-check-label" for="social"
                        >Social Sciences</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="cs"
                        name="academic_interests"
                        value="cs"
                      />
                      <label class="form-check-label" for="cs"
                        >Computer Science & Programming</label
                      >
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="academic-interests">
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="engineering"
                        name="academic_interests"
                        value="engineering"
                      />
                      <label class="form-check-label" for="engineering"
                        >Engineering & Robotics</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="business"
                        name="academic_interests"
                        value="business"
                      />
                      <label class="form-check-label" for="business"
                        >Business & Entrepreneurship</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="health"
                        name="academic_interests"
                        value="health"
                      />
                      <label class="form-check-label" for="health"
                        >Health & Medicine</label
                      >
                    </div>
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="other_academic"
                        name="academic_interests"
                        value="other"
                      />
                      <label class="form-check-label" for="other_academic"
                        >Other</label
                      >
                    </div>
                    <div
                      id="other_academic_input"
                      class="mb-2 ms-4"
                      style="display: none"
                    >
                      <input
                        type="text"
                        class="form-control form-control-sm"
                        placeholder="Please specify"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Extracurricular Interests -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="fas fa-hobby me-2"></i>Extracurricular Interests
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="music"
                      name="extracurricular"
                      value="music"
                    />
                    <label class="form-check-label" for="music">Music</label>
                  </div>
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="sports"
                      name="extracurricular"
                      value="sports"
                    />
                    <label class="form-check-label" for="sports">Sports</label>
                  </div>
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="arts_crafts"
                      name="extracurricular"
                      value="arts_crafts"
                    />
                    <label class="form-check-label" for="arts_crafts"
                      >Arts & Crafts</label
                    >
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="gaming"
                      name="extracurricular"
                      value="gaming"
                    />
                    <label class="form-check-label" for="gaming"
                      >Gaming & eSports</label
                    >
                  </div>
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="volunteering"
                      name="extracurricular"
                      value="volunteering"
                    />
                    <label class="form-check-label" for="volunteering"
                      >Volunteering & Community Service</label
                    >
                  </div>
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="debate"
                      name="extracurricular"
                      value="debate"
                    />
                    <label class="form-check-label" for="debate"
                      >Debate/Public Speaking</label
                    >
                  </div>
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="other_extra"
                      name="extracurricular"
                      value="other"
                    />
                    <label class="form-check-label" for="other_extra"
                      >Other</label
                    >
                  </div>
                  <div
                    id="other_extra_input"
                    class="mb-2 ms-4"
                    style="display: none"
                  >
                    <input
                      type="text"
                      class="form-control form-control-sm"
                      placeholder="Please specify"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Mentor Preferences -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="fas fa-user-graduate me-2"></i>Mentor Preferences
              </h5>
              <div class="mb-4">
                <label class="form-label">Preferred Type of Mentor</label>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="mentor_type"
                    id="academic_mentor"
                    value="academic"
                    required
                  />
                  <label class="form-check-label" for="academic_mentor">
                    <strong>Academic Mentor</strong>
                    <div class="text-muted small">
                      Subject tutoring, academic counseling
                    </div>
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="mentor_type"
                    id="career_mentor"
                    value="career"
                  />
                  <label class="form-check-label" for="career_mentor">
                    <strong>Career Mentor</strong>
                    <div class="text-muted small">
                      Career advice, internships, job shadowing
                    </div>
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="mentor_type"
                    id="personal_mentor"
                    value="personal"
                  />
                  <label class="form-check-label" for="personal_mentor">
                    <strong>Personal Development Mentor</strong>
                    <div class="text-muted small">
                      Life skills, social-emotional learning
                    </div>
                  </label>
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label"
                  >Availability for Mentoring Sessions</label
                >
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="weekdays"
                    name="availability"
                    value="weekdays"
                  />
                  <label class="form-check-label" for="weekdays"
                    >Weekdays (After School)</label
                  >
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="weekends"
                    name="availability"
                    value="weekends"
                  />
                  <label class="form-check-label" for="weekends"
                    >Weekends</label
                  >
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="flexible"
                    name="availability"
                    value="flexible"
                  />
                  <label class="form-check-label" for="flexible"
                    >Flexible/Unsure</label
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Goals and Additional Information -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="fas fa-bullseye me-2"></i>Goals and Additional
                Information
              </h5>
              <div class="mb-4">
                <label for="goals" class="form-label"
                  >What do you hope to achieve through this mentoring
                  program?</label
                >
                <textarea
                  class="form-control"
                  id="goals"
                  rows="4"
                  required
                ></textarea>
                <div class="invalid-feedback">
                  Please share your goals for the mentorship.
                </div>
              </div>
              <div class="mb-4">
                <label for="additional_info" class="form-label"
                  >Additional Information / Special Needs (Optional)</label
                >
                <textarea
                  class="form-control"
                  id="additional_info"
                  rows="3"
                  placeholder="Any specific preferences, accessibility requirements, or circumstances to consider?"
                ></textarea>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between">
            <button
              type="button"
              class="btn btn-secondary px-4"
              id="back-to-personal"
            >
              <i class="fas fa-arrow-left me-2"></i>Back
            </button>
            <button
              type="submit"
              class="btn btn-primary px-4"
              id="analyze-edge-btn"
            >
              Next: Edge Analysis <i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </form>
      </section>

      <!-- Step 3: Edge Analysis -->
      <section
        id="edge-analysis-section"
        class="form-section"
        style="display: none"
      >
        <div class="section-header">
          <h2><i class="fas fa-chart-bar me-2"></i>Edge Analysis</h2>
          <p>Analysis of your skills, strengths, and growth opportunities</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Skills Radar</h5>
                <canvas id="skills-radar-chart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Summary</h5>
                <p id="analysis-summary" class="card-text"></p>
                <div
                  id="strengths-list"
                  class="list-group list-group-flush mt-3"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Growth Areas</h5>
                <div id="growth-areas-container"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Recommendations</h5>
            <div id="recommendations-container"></div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button
            type="button"
            class="btn btn-primary px-4"
            id="next-to-projects"
          >
            Generate Project Ideas <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </section>

      <!-- Step 4: Project Generation -->
      <section
        id="project-generation-section"
        class="form-section"
        style="display: none"
      >
        <div class="section-header">
          <h2><i class="fas fa-lightbulb me-2"></i>Project Ideas Generator</h2>
          <p>Generate project ideas based on your interests and strengths</p>
        </div>

        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-heart me-2"></i>Your Interests
                  <button
                    class="btn btn-sm btn-outline-primary float-end"
                    id="add-interest-btn"
                  >
                    <i class="fas fa-plus"></i> Add Interest
                  </button>
                </h5>
                <div id="interests-checkboxes" class="mb-3">
                  <!-- Interests will be populated here -->
                </div>
                <div
                  id="new-interest-form"
                  class="input-group mb-3"
                  style="display: none"
                >
                  <input
                    type="text"
                    class="form-control"
                    id="new-interest-input"
                    placeholder="Enter new interest"
                  />
                  <button class="btn btn-primary" id="save-interest-btn">
                    Add
                  </button>
                  <button class="btn btn-secondary" id="cancel-interest-btn">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="fas fa-star me-2"></i>Your Strengths
                  <button
                    class="btn btn-sm btn-outline-primary float-end"
                    id="add-strength-btn"
                  >
                    <i class="fas fa-plus"></i> Add Strength
                  </button>
                </h5>
                <div id="strengths-checkboxes" class="mb-3">
                  <!-- Strengths will be populated here -->
                </div>
                <div
                  id="new-strength-form"
                  class="input-group mb-3"
                  style="display: none"
                >
                  <input
                    type="text"
                    class="form-control"
                    id="new-strength-input"
                    placeholder="Enter new strength"
                  />
                  <button class="btn btn-primary" id="save-strength-btn">
                    Add
                  </button>
                  <button class="btn btn-secondary" id="cancel-strength-btn">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center mb-4">
          <button
            type="button"
            class="btn btn-primary btn-lg"
            id="generate-projects-btn"
          >
            <i class="fas fa-magic me-2"></i>Generate Project Ideas
          </button>
        </div>

        <div class="row" id="project-ideas-container">
          <!-- Project ideas will be displayed here -->
        </div>

        <div id="saved-projects-section" class="mt-4">
          <h5 class="mb-3">
            <i class="fas fa-thumbtack me-2"></i>Saved Projects
          </h5>
          <div class="row" id="saved-projects-container">
            <!-- Saved projects will be displayed here -->
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary px-4"
            id="back-to-edge-analysis"
          >
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
        </div>
      </section>

      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loading-overlay">
        <div class="spinner mb-3"></div>
        <h4 id="loading-text">Processing your information...</h4>
      </div>

      <!-- Success Message -->
      <div class="success-message" id="success-message">
        <i class="fas fa-check-circle me-2"></i>
        <span id="success-text">Content copied to clipboard!</span>
      </div>

      <!-- Restart Modal -->
      <div
        class="modal fade"
        id="restart-modal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Start Over?</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p>
                Would you like to start the process over with a fresh worksheet?
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                No, Keep Working
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="confirm-restart"
              >
                Yes, Start Over
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script
      src="https://elevenlabs.io/convai-widget/index.js"
      async
      type="text/javascript"
    ></script>

    <script>
      $(document).ready(function () {
        // Initialize variables
        let userData = {
          personalInfo: {},
          skills: [],
          skillsToLearn: [],
          projects: [],
          edgeAnalysisResult: {},
        };

        // Initialize localStorage if needed
        if (localStorage.getItem("edgeAnalysisData")) {
          try {
            userData = JSON.parse(localStorage.getItem("edgeAnalysisData"));
            loadSavedData();
          } catch (e) {
            console.error("Error loading saved data:", e);
          }
        }

        // Set up Bootstrap components
        const restartModal = new bootstrap.Modal(
          document.getElementById("restart-modal")
        );

        // Navigation between sections
        $("#next-to-skills").click(function () {
          // Basic validation
          if ($("#name").val().trim() === "") {
            alert("Please enter your name");
            $("#name").focus();
            return;
          }

          if ($("#age").val().trim() === "") {
            alert("Please enter your age");
            $("#age").focus();
            return;
          }

          const age = parseInt($("#age").val());
          if (isNaN(age) || age < 5 || age > 18) {
            alert("Please enter a valid age between 5 and 18");
            $("#age").focus();
            return;
          }

          // If validation passes, save and proceed
          savePersonalInfo();
          $("#personal-info-section").hide();
          $("#skills-section").show();
          updateProgressIndicator(2);
        });

        $("#back-to-personal").click(function () {
          $("#skills-section").hide();
          $("#personal-info-section").show();
          updateProgressIndicator(1);
        });

        $("#back-to-skills").click(function () {
          $("#edge-analysis-section").hide();
          $("#skills-section").show();
          updateProgressIndicator(2);
        });

        // Update progress indicator
        function updateProgressIndicator(step) {
          $(".progress-step").removeClass("active completed");
          for (let i = 1; i < step; i++) {
            $(`#step${i}`).addClass("completed");
          }
          $(`#step${step}`).addClass("active");
        }

        // Handle tags input (for interests)
        $(".tag-input").keydown(function (e) {
          if (e.key === "Enter" && $(this).val().trim() !== "") {
            e.preventDefault();
            const inputId = $(this).attr("id");
            const containerId = inputId.replace("-input", "-container");
            const tagText = $(this).val().trim();

            addTag(containerId, tagText);
            $(this).val("");
          }
        });

        function addTag(containerId, text) {
          const tag = $(`
            <div class="tag">
              ${text}
              <span class="tag-remove"><i class="fas fa-times"></i></span>
            </div>
          `);

          tag.find(".tag-remove").click(function () {
            $(this).parent().remove();
          });

          $(`#${containerId}`).append(tag);
        }

        // Skills section
        $("#add-skill-btn").click(function () {
          const skillName = $("#skill-input").val().trim();
          if (skillName) {
            addSkill(skillName);
            $("#skill-input").val("").focus();
          }
        });

        function addSkill(skillName) {
          const skillElement = $(`
            <div class="card mb-2 skill-card">
              <div class="card-body py-2">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="skill-name">${skillName}</span>
                  <button type="button" class="btn-close remove-skill" aria-label="Remove"></button>
                </div>
                <div class="skill-level" data-skill="${skillName}">
                    <span class="ms-2 text-muted small">Beginner</span>
                  <div class="skill-level-circle" data-level="1"></div>
                  <div class="skill-level-circle" data-level="2"></div>
                  <div class="skill-level-circle" data-level="3"></div>
                  <div class="skill-level-circle" data-level="4"></div>
                  <div class="skill-level-circle" data-level="5"></div>
                  <span class="ms-2 text-muted small">Expert</span>
                </div>
              </div>
            </div>
          `);

          skillElement.find(".remove-skill").click(function () {
            $(this).closest(".skill-card").remove();
          });

          skillElement.find(".skill-level-circle").click(function () {
            const level = $(this).data("level");
            const skillName = $(this).parent().data("skill");

            // Reset all circles
            $(this).parent().find(".skill-level-circle").removeClass("filled");

            // Fill circles up to the selected level
            $(this)
              .parent()
              .find(".skill-level-circle")
              .each(function () {
                if ($(this).data("level") <= level) {
                  $(this).addClass("filled");
                }
              });

            // Update skill in userData
            const skillIndex = userData.skills.findIndex(
              (s) => s.name === skillName
            );
            if (skillIndex !== -1) {
              userData.skills[skillIndex].level = level;
            } else {
              userData.skills.push({ name: skillName, level: level });
            }
            saveToLocalStorage();
          });

          $("#skills-list").append(skillElement);
        }

        // Project section
        $("#add-project-btn").click(function () {
          addProject("");
        });

        function addProject(description) {
          const projectElement = $(`
            <div class="mb-3">
              <textarea class="form-control mb-2 project-description" rows="2" placeholder="Describe a project or achievement">${description}</textarea>
              <button type="button" class="btn btn-sm btn-outline-danger remove-project">Remove</button>
            </div>
          `);

          projectElement.find(".remove-project").click(function () {
            $(this).closest(".mb-3").remove();
          });

          $("#projects-list").append(projectElement);
        }

        // Edge Analysis
        $("#analyze-edge-btn").click(async function () {
          saveSkillsAndProjects();
          showLoading("Analyzing your edge...");

          try {
            // Prepare payload for EdgeAnalysisLoop
            const edgePayload = {
              studentName: $("#name").val() || "Anonymous Student",
              name: $("#name").val() || "Anonymous Student",
              age: $("#age").val() || "",
              interests: userData.personalInfo.interests || [],
              skills:
                userData.skills.map((skill) => ({
                  name: skill.name,
                  proficiency: skill.level,
                })) || [],
              skillsToLearn: userData.skillsToLearn || [],
              projects: userData.projects || [],
            };

            // Call EdgeAnalysisLoop
            const edgeResponse = await fetch(
              "https://magicloops.dev/api/loop/66a39aa2-5117-44a0-8ea3-7341019153f2/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Accept: "application/json",
                },
                body: JSON.stringify(edgePayload),
              }
            );

            if (!edgeResponse.ok) {
              throw new Error(`HTTP error! status: ${edgeResponse.status}`);
            }

            const edgeResult = await edgeResponse.json();

            // Update UI with analysis results
            if (edgeResult) {
              userData.edgeAnalysisResult = edgeResult;

              // Display summary
              $("#analysis-summary").text(edgeResult.summary);

              // Display strengths
              const strengthsList = $("#strengths-list");
              strengthsList.empty();
              edgeResult.strengths.forEach((strength) => {
                strengthsList.append(`
                  <li class="list-group-item">
                    <i class="fas fa-check-circle text-success me-2"></i>${strength}
                  </li>
                `);
              });

              // Display growth areas
              const growthAreasContainer = $("#growth-areas-container");
              growthAreasContainer.empty();
              edgeResult.growth_areas.forEach((area) => {
                growthAreasContainer.append(`
                  <div class="card growth-area-card">
                    <div class="card-body">
                      <h6 class="card-title">${area.skill} (${
                  area.category
                })</h6>
                      <p class="card-text">
                        <span class="badge bg-primary">Current Level: ${
                          area.current_level
                        }</span>
                        <span class="badge bg-${
                          area.recommended_focus.toLowerCase() === "high"
                            ? "danger"
                            : "warning"
                        }">
                          ${area.recommended_focus} Priority
                        </span>
                      </p>
                      <p class="card-text text-muted">${area.reason}</p>
                    </div>
                  </div>
                `);
              });

              // Display recommendations
              const recommendationsContainer = $("#recommendations-container");
              recommendationsContainer.empty();
              edgeResult.recommendations.forEach((rec) => {
                const nextStepsList = rec.next_steps
                  .map(
                    (step) =>
                      `<li class="list-group-item"><i class="fas fa-arrow-right me-2"></i>${step}</li>`
                  )
                  .join("");

                recommendationsContainer.append(`
                  <div class="card recommendation-card">
                    <div class="card-body">
                      <h6 class="card-title">
                        ${rec.title}
                        <span class="badge bg-${
                          rec.priority.toLowerCase() === "high"
                            ? "danger"
                            : "warning"
                        } ms-2">
                          ${rec.priority} Priority
                        </span>
                      </h6>
                      <p class="card-text">${rec.description}</p>
                      <h6 class="mt-3">Next Steps:</h6>
                      <ul class="list-group list-group-flush">
                        ${nextStepsList}
                      </ul>
                    </div>
                  </div>
                `);
              });

              // Create radar chart
              createSkillsRadarChart(edgeResult.metrics);
            }

            // Show edge analysis section
            $("#skills-section").hide();
            $("#edge-analysis-section").show();
            updateProgressIndicator(3);
          } catch (error) {
            console.error("Error analyzing edge:", error);
            alert(
              "There was an error analyzing your edge. Please try again. Error: " +
                error.message
            );
          } finally {
            hideLoading();
          }
        });

        let skillsRadarChart = null;

        function createSkillsRadarChart(metrics) {
          const ctx = document
            .getElementById("skills-radar-chart")
            .getContext("2d");

          // Destroy existing chart if it exists
          if (skillsRadarChart) {
            skillsRadarChart.destroy();
          }

          // Format labels to be capitalized
          const formatLabel = (label) => {
            return label.charAt(0).toUpperCase() + label.slice(1);
          };

          // Ensure metrics are parsed as numbers
          const labels = Object.keys(metrics).map(formatLabel);
          const values = Object.values(metrics).map((value) =>
            parseFloat(value)
          );

          skillsRadarChart = new Chart(ctx, {
            type: "radar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Core Competencies",
                  data: values,
                  fill: true,
                  backgroundColor: "rgba(79, 70, 229, 0.2)",
                  borderColor: "rgb(79, 70, 229)",
                  pointBackgroundColor: "rgb(79, 70, 229)",
                  pointBorderColor: "#fff",
                  pointHoverBackgroundColor: "#fff",
                  pointHoverBorderColor: "rgb(79, 70, 229)",
                },
              ],
            },
            options: {
              elements: {
                line: {
                  borderWidth: 3,
                },
              },
              scales: {
                r: {
                  angleLines: {
                    display: true,
                  },
                  suggestedMin: 0,
                  suggestedMax: 5,
                  ticks: {
                    stepSize: 1,
                    callback: function (value) {
                      return value.toFixed(1);
                    },
                  },
                },
              },
              plugins: {
                legend: {
                  display: true,
                  position: "bottom",
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw.toFixed(1)}/5`;
                    },
                  },
                },
              },
            },
          });
        }

        // Save functions
        function savePersonalInfo() {
          userData.personalInfo = {
            name: $("#name").val().trim(),
            age: $("#age").val().trim(),
            gradeLevel: $("#gradeLevel").val(),
            schoolDistrict: $("#schoolDistrict").val(),
            schoolName: $("#schoolName").val().trim(),
            cityNeighborhood: $("#cityNeighborhood").val().trim(),
            preferredLanguage: $(
              'input[name="preferredLanguage"]:checked'
            ).val(),
            otherLanguage: $("#otherLanguageSpecify").val().trim(),
            guardianContact: $("#guardianContact").val().trim(),
            interests: [],
          };

          // Get interests
          $("#interests-container .tag").each(function () {
            const interest = $(this).text().trim().replace("Ã—", "");
            userData.personalInfo.interests.push(interest);
          });

          saveToLocalStorage();
        }

        function saveSkillsAndProjects() {
          // Skills already saved when rated

          // Save skills to learn
          userData.skillsToLearn = [];
          $("#skills-to-learn-container .tag").each(function () {
            const skill = $(this).text().trim().replace("Ã—", "");
            userData.skillsToLearn.push(skill);
          });

          // Save projects
          userData.projects = [];
          $(".project-description").each(function () {
            const project = $(this).val().trim();
            if (project) {
              userData.projects.push(project);
            }
          });

          saveToLocalStorage();
        }

        function saveToLocalStorage() {
          localStorage.setItem("edgeAnalysisData", JSON.stringify(userData));
        }

        // Load saved data
        function loadSavedData() {
          if (userData.personalInfo) {
            $("#name").val(userData.personalInfo.name || "");
            $("#age").val(userData.personalInfo.age || "");
            $("#gradeLevel").val(userData.personalInfo.gradeLevel || "");
            $("#schoolDistrict").val(
              userData.personalInfo.schoolDistrict || ""
            );
            $("#schoolName").val(userData.personalInfo.schoolName || "");
            $("#cityNeighborhood").val(
              userData.personalInfo.cityNeighborhood || ""
            );

            // Set preferred language
            if (userData.personalInfo.preferredLanguage) {
              $(
                `input[name="preferredLanguage"][value="${userData.personalInfo.preferredLanguage}"]`
              ).prop("checked", true);
              if (userData.personalInfo.preferredLanguage === "other") {
                $("#otherLanguageInput").show();
                $("#otherLanguageSpecify").val(
                  userData.personalInfo.otherLanguage || ""
                );
              }
            }

            $("#guardianContact").val(
              userData.personalInfo.guardianContact || ""
            );

            // Load interests
            if (userData.personalInfo.interests) {
              userData.personalInfo.interests.forEach((interest) => {
                addTag("interests-container", interest);
              });
            }
          }

          // Skills
          if (userData.skills) {
            userData.skills.forEach((skill) => {
              addSkill(skill.name);
              // Set skill level
              const skillLevel = $(`.skill-level[data-skill="${skill.name}"]`);
              if (skillLevel.length > 0 && skill.level) {
                skillLevel.find(".skill-level-circle").each(function () {
                  if ($(this).data("level") <= skill.level) {
                    $(this).addClass("filled");
                  }
                });
              }
            });
          }

          // Skills to learn
          if (userData.skillsToLearn) {
            userData.skillsToLearn.forEach((skill) => {
              addTag("skills-to-learn-container", skill);
            });
          }

          // Projects
          if (userData.projects) {
            $("#projects-list").empty();
            userData.projects.forEach((project) => {
              addProject(project);
            });
          }
        }

        // UI Helpers
        function showLoading(message) {
          $("#loading-text").text(message || "Processing...");
          $("#loading-overlay").addClass("active");
        }

        function hideLoading() {
          $("#loading-overlay").removeClass("active");
        }

        function showSuccessMessage(message) {
          $("#success-text").text(message);
          $("#success-message").addClass("show");

          setTimeout(() => {
            $("#success-message").removeClass("show");
          }, 3000);
        }

        function clearData() {
          localStorage.removeItem("edgeAnalysisData");
        }

        // Initialize all tooltips
        var tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Initialize project generation variables
        let savedProjects = [];
        if (localStorage.getItem("savedProjects")) {
          try {
            savedProjects = JSON.parse(localStorage.getItem("savedProjects"));
          } catch (e) {
            console.error("Error loading saved projects:", e);
          }
        }

        // Navigation handlers
        $(document).on("click", "#next-to-projects", function () {
          $("#edge-analysis-section").hide();
          $("#project-generation-section").show();
          updateProgressIndicator(4);
          populateInterestsAndStrengths();
        });

        $("#back-to-edge-analysis").click(function () {
          $("#project-generation-section").hide();
          $("#edge-analysis-section").show();
          updateProgressIndicator(3);
        });

        function populateInterestsAndStrengths() {
          // Get interests from personal info
          const interests = userData.personalInfo.interests || [];
          const interestsHtml = interests
            .map(
              (interest) => `
            <div class="form-check d-flex justify-content-between align-items-center">
              <div>
                <input class="form-check-input interest-checkbox" type="checkbox" value="${interest}" id="interest-${interest}">
                <label class="form-check-label" for="interest-${interest}">
                  ${interest}
                </label>
              </div>
              <button class="btn btn-sm btn-outline-danger remove-interest" data-interest="${interest}">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `
            )
            .join("");
          $("#interests-checkboxes").html(interestsHtml);

          // Get strengths from edge analysis
          const strengths = userData.edgeAnalysisResult.strengths || [];
          const strengthsHtml = strengths
            .map(
              (strength) => `
            <div class="form-check d-flex justify-content-between align-items-center">
              <div>
                <input class="form-check-input strength-checkbox" type="checkbox" value="${strength}" id="strength-${strength}">
                <label class="form-check-label" for="strength-${strength}">
                  ${strength}
                </label>
              </div>
              <button class="btn btn-sm btn-outline-danger remove-strength" data-strength="${strength}">
                <i class="fas fa-times"></i>
              </button>
            </div>
              `
            )
            .join("");
          $("#strengths-checkboxes").html(strengthsHtml);

          // Display saved projects
          displaySavedProjects();
        }

        // Add event handlers for interests
        $("#add-interest-btn").click(function () {
          $("#new-interest-form").show();
          $("#new-interest-input").focus();
        });

        $("#cancel-interest-btn").click(function () {
          $("#new-interest-form").hide();
          $("#new-interest-input").val("");
        });

        $("#save-interest-btn").click(function () {
          const newInterest = $("#new-interest-input").val().trim();
          if (newInterest) {
            userData.personalInfo.interests =
              userData.personalInfo.interests || [];
            if (!userData.personalInfo.interests.includes(newInterest)) {
              userData.personalInfo.interests.push(newInterest);
              saveToLocalStorage();
              populateInterestsAndStrengths();
            }
            $("#new-interest-form").hide();
            $("#new-interest-input").val("");
          }
        });

        $(document).on("click", ".remove-interest", function () {
          const interest = $(this).data("interest");
          userData.personalInfo.interests =
            userData.personalInfo.interests.filter((i) => i !== interest);
          saveToLocalStorage();
          populateInterestsAndStrengths();
        });

        // Add event handlers for strengths
        $("#add-strength-btn").click(function () {
          $("#new-strength-form").show();
          $("#new-strength-input").focus();
        });

        $("#cancel-strength-btn").click(function () {
          $("#new-strength-form").hide();
          $("#new-strength-input").val("");
        });

        $("#save-strength-btn").click(function () {
          const newStrength = $("#new-strength-input").val().trim();
          if (newStrength) {
            userData.edgeAnalysisResult.strengths =
              userData.edgeAnalysisResult.strengths || [];
            if (!userData.edgeAnalysisResult.strengths.includes(newStrength)) {
              userData.edgeAnalysisResult.strengths.push(newStrength);
              saveToLocalStorage();
              populateInterestsAndStrengths();
            }
            $("#new-strength-form").hide();
            $("#new-strength-input").val("");
          }
        });

        $(document).on("click", ".remove-strength", function () {
          const strength = $(this).data("strength");
          userData.edgeAnalysisResult.strengths =
            userData.edgeAnalysisResult.strengths.filter((s) => s !== strength);
          saveToLocalStorage();
          populateInterestsAndStrengths();
        });

        $("#generate-projects-btn").click(async function () {
          const selectedInterests = $(".interest-checkbox:checked")
            .map(function () {
              return $(this).val();
            })
            .get();

          const selectedStrengths = $(".strength-checkbox:checked")
            .map(function () {
              return $(this).val();
            })
            .get();

          if (
            selectedInterests.length === 0 ||
            selectedStrengths.length === 0
          ) {
            alert("Please select at least one interest and one strength.");
            return;
          }

          try {
            showLoading("Generating project ideas...");

            const response = await fetch(
              "https://magicloops.dev/api/loop/d490e73f-6867-4379-b93b-4b2adac269e2/run",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  interests: selectedInterests.join(", "),
                  strengths: selectedStrengths.join(", "),
                }),
              }
            );

            if (!response.ok) {
              throw new Error("Failed to generate project ideas");
            }

            const result = await response.json();
            displayProjectIdeas(result.ideas);
          } catch (error) {
            console.error("Error generating project ideas:", error);
            alert("Failed to generate project ideas. Please try again.");
          } finally {
            hideLoading();
          }
        });

        function displayProjectIdeas(ideas) {
          const projectsHtml = ideas
            .map(
              (idea) => `
            <div class="col-md-4 mb-4">
              <div class="card h-100 project-card" data-project='${JSON.stringify(
                idea
              )}'>
                <button class="btn btn-link pin-btn" onclick="toggleProjectPin(this)">
                  <i class="fas fa-thumbtack"></i>
                </button>
                <div class="card-body">
                  <h5 class="card-title">${idea.title}</h5>
                  <p class="card-text">${idea.description}</p>
                  
                  <div class="mentor-section">
                    <div class="mentor-header">
                      <img src="${idea.mentor.image_url}" 
                           alt="${idea.mentor.name}" 
                           class="mentor-image"
                           onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(
                             idea.mentor.name
                           )}&background=4f46e5&color=fff'">
                      <div>
                        <h6 class="mentor-name">${idea.mentor.name}</h6>
                        <small class="text-muted">Project Mentor</small>
                      </div>
                    </div>
                    <p class="mentor-bio">${idea.mentor.bio}</p>
                  </div>
                </div>
              </div>
            </div>
          `
            )
            .join("");

          $("#project-ideas-container").html(projectsHtml);
        }

        function toggleProjectPin(btn) {
          const card = $(btn).closest(".project-card");
          const project = JSON.parse(card.attr("data-project"));

          if ($(btn).hasClass("pinned")) {
            // Unpin project
            $(btn).removeClass("pinned");
            card.removeClass("saved");
            savedProjects = savedProjects.filter(
              (p) => p.title !== project.title
            );
          } else {
            // Pin project
            $(btn).addClass("pinned");
            card.addClass("saved");
            if (!savedProjects.some((p) => p.title === project.title)) {
              savedProjects.push(project);
            }
          }

          // Save to localStorage
          localStorage.setItem("savedProjects", JSON.stringify(savedProjects));
          displaySavedProjects();
        }

        function displaySavedProjects() {
          if (savedProjects.length === 0) {
            $("#saved-projects-section").hide();
            return;
          }

          const savedProjectsHtml = savedProjects
            .map(
              (project) => `
            <div class="col-md-4 mb-4">
              <div class="card h-100 project-card saved">
                <button class="btn btn-link pin-btn pinned" onclick="toggleProjectPin(this)">
                  <i class="fas fa-thumbtack"></i>
                </button>
                <div class="card-body">
                  <h5 class="card-title">${project.title}</h5>
                  <p class="card-text">${project.description}</p>
                  
                  <div class="mentor-section">
                    <div class="mentor-header">
                      <img src="${project.mentor.image_url}" 
                           alt="${project.mentor.name}" 
                           class="mentor-image"
                           onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(
                             project.mentor.name
                           )}&background=4f46e5&color=fff'">
                      <div>
                        <h6 class="mentor-name">${project.mentor.name}</h6>
                        <small class="text-muted">Project Mentor</small>
                      </div>
                    </div>
                    <p class="mentor-bio">${project.mentor.bio}</p>
                  </div>
                </div>
              </div>
            </div>
          `
            )
            .join("");

          $("#saved-projects-container").html(savedProjectsHtml);
          $("#saved-projects-section").show();
        }

        // Handle "Other" toggles
        $("#other_academic").change(function () {
          $("#other_academic_input").toggle(this.checked);
        });

        $("#other_extra").change(function () {
          $("#other_extra_input").toggle(this.checked);
        });

        // Form validation and submission
        $("#interests-form").on("submit", function (e) {
          e.preventDefault();

          if (this.checkValidity()) {
            // Save the data
            saveInterestsData();
            // Proceed to next section
            $("#skills-section").hide();
            $("#edge-analysis-section").show();
            updateProgressIndicator(3);
          }

          $(this).addClass("was-validated");
        });

        function saveInterestsData() {
          userData.interests = {
            academic: $('input[name="academic_interests"]:checked')
              .map(function () {
                const val = $(this).val();
                return val === "other"
                  ? $("#other_academic_input input").val()
                  : val;
              })
              .get(),
            extracurricular: $('input[name="extracurricular"]:checked')
              .map(function () {
                const val = $(this).val();
                return val === "other"
                  ? $("#other_extra_input input").val()
                  : val;
              })
              .get(),
            mentor_type: $('input[name="mentor_type"]:checked').val(),
            availability: $('input[name="availability"]:checked')
              .map(function () {
                return $(this).val();
              })
              .get(),
            goals: $("#goals").val().trim(),
            additional_info: $("#additional_info").val().trim(),
          };

          saveToLocalStorage();
        }

        // Load saved data if exists
        function loadInterestsData() {
          if (userData.interests) {
            // Load academic interests
            userData.interests.academic.forEach((interest) => {
              if (interest === "other") {
                $("#other_academic").prop("checked", true);
                $("#other_academic_input").show();
                $("#other_academic_input input").val(
                  userData.interests.other_academic
                );
              } else {
                $(`input[name="academic_interests"][value="${interest}"]`).prop(
                  "checked",
                  true
                );
              }
            });

            // Load extracurricular interests
            userData.interests.extracurricular.forEach((interest) => {
              if (interest === "other") {
                $("#other_extra").prop("checked", true);
                $("#other_extra_input").show();
                $("#other_extra_input input").val(
                  userData.interests.other_extra
                );
              } else {
                $(`input[name="extracurricular"][value="${interest}"]`).prop(
                  "checked",
                  true
                );
              }
            });

            // Load mentor type
            if (userData.interests.mentor_type) {
              $(
                `input[name="mentor_type"][value="${userData.interests.mentor_type}"]`
              ).prop("checked", true);
            }

            // Load availability
            userData.interests.availability.forEach((availability) => {
              $(`input[name="availability"][value="${availability}"]`).prop(
                "checked",
                true
              );
            });

            // Load goals and additional info
            $("#goals").val(userData.interests.goals || "");
            $("#additional_info").val(userData.interests.additional_info || "");
          }
        }

        // Load saved data on page load
        loadInterestsData();
      });
    </script>

    <script>
      $(document).ready(function () {
        // Update any dynamically created elements
        $(".skill-level-circle.filled").css(
          "background-color",
          "var(--primary-color)"
        );
        $(".mentor-bio").css("color", "#666"); // Keep this neutral

        // Update Chart.js colors if used
        if (typeof skillsRadarChart !== "undefined") {
          skillsRadarChart.data.datasets[0].backgroundColor =
            "rgba(16, 185, 129, 0.2)";
          skillsRadarChart.data.datasets[0].borderColor = "rgb(16, 185, 129)";
          skillsRadarChart.data.datasets[0].pointBackgroundColor =
            "rgb(16, 185, 129)";
          skillsRadarChart.data.datasets[0].pointHoverBorderColor =
            "rgb(16, 185, 129)";
          skillsRadarChart.update();
        }
      });
    </script>
  </body>
</html>
